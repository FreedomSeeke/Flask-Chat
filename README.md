# 简易Flask聊天系统项目介绍文档

# 一、项目概述

本项目是一个基于Flask框架开发的简易聊天系统，支持用户注册登录、实时文字聊天、聊天记录搜索与清空、图片/音频文件发送、管理员权限管理等核心功能。系统采用「前端模板嵌入+后端API服务」的混合架构，通过SocketIO实现实时通信，MySQL存储用户与消息数据，整体设计轻量易懂，适合用于学习Flask Web开发、WebSocket实时通信、文件上传处理及用户权限管控等场景。

# 二、技术栈说明

## 2.1 后端技术

- 核心框架：Flask（轻量级Python Web框架，快速搭建Web服务）

- 数据库ORM：Flask-SQLAlchemy（简化MySQL数据库操作，无需手动编写SQL）

- 用户认证：Flask-Login（管理用户会话、登录状态及身份验证）

- 实时通信：Flask-SocketIO（基于WebSocket协议，实现消息实时推送与接收）

- 文件处理：Werkzeug（安全处理文件上传、文件名过滤及密码哈希加密）

- 数据库：MySQL 8.0（存储用户信息、聊天记录、文件路径及权限状态等数据）

## 2.2 前端技术

- 基础结构：HTML5（构建页面骨架，支持文件上传、音频播放等原生功能）

- 样式美化：CSS3（实现页面布局、响应式设计及消息气泡样式）

- 交互逻辑：JavaScript + jQuery（处理表单提交、DOM操作、AJAX请求及SocketIO客户端通信）

- 图标支持：Font-Awesome（提供文件上传、用户状态、功能按钮等图标，优化视觉体验）

## 2.3 开发环境依赖

- Python版本：3.10（兼容项目所有依赖包，避免版本兼容问题）

- MySQL版本：8.0（需提前启动服务，配置用户密码）

- 核心依赖包：
       
flask、flask-sqlalchemy、flask-login、flask-socketio、pymysql、werkzeug、eventlet
      

# 三、环境搭建步骤

## 3.1 本地环境准备

1. 安装Python：从Python官网下载3.10版本，安装时勾选「Add Python to PATH」，安装完成后在命令行执行 `python --version`，显示Python 3.10.x即为成功。

2. 安装MySQL：下载MySQL 8.0安装包，安装过程中设置root用户密码（本项目默认密码为123456，可后续修改）。安装完成后，确保MySQL服务正常启动：
        
- Windows：通过「服务」面板启动MySQL，或执行命令 `net start mysql`
- Linux/Mac：执行命令 `sudo service mysql start`

## 3.2 项目部署与依赖安装

1. 下载项目源码，解压后进入项目根目录。

2. 执行依赖包安装命令，建议使用国内镜像源提升速度：
        `pip install -i https://pypi.tuna.tsinghua.edu.cn/simple flask flask-sqlalchemy flask-login flask-socketio pymysql werkzeug eventlet`

## 3.3 数据库配置

1. 创建数据库：手动登录MySQL，执行以下SQL创建项目数据库（编码设为utf8mb4，支持表情符号）：
        `CREATE DATABASE IF NOT EXISTS wechat_chat DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci;`
        项目启动后会自动创建用户表（users）和消息表（messages），无需手动创建表结构。
也可通过手动导入sql文件：[flask数据.sql](https://raw.githubusercontent.com/FreedomSeeke/Flask-Chat/main/flask数据库.sql)   

2. 修改数据库连接配置（可选）：若MySQL root密码、地址或端口与默认不同，打开项目根目录的 `app.py`，修改以下配置项：
        `app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql+pymysql://root:你的密码@localhost:3306/wechat_chat?charset=utf8mb4'`

# 四、核心功能说明

## 4.1 基础功能（普通用户）

- 用户注册：用户名唯一，密码采用PBKDF2-SHA256加密存储，强制要求「字母+数字组合，长度≥6位」，避免弱密码。

- 用户登录/退出：登录验证密码正确性，记录登录设备及最后登录时间；退出时清空会话ID，更新在线状态为离线。

- 单设备登录限制：同一账号在其他设备登录时，原设备会被强制下线并提示，保障账号安全。

- 联系人列表：展示所有已注册且未被封号的用户，通过绿色（在线）/灰色（离线）圆点区分状态。

## 4.2 聊天功能

- 实时文字聊天：选择联系人后可发送文字消息，基于SocketIO实现消息实时推送，自己的消息显示在右侧，对方消息显示在左侧，区分清晰。

- 文件发送：支持图片（png、jpg、jpeg、gif、bmp、webp）和音频（mp3、wav、ogg、m4a、flac）文件发送，图片可预览、音频可在线播放。

- 聊天记录加载：选择联系人后自动加载历史聊天记录，包含文字、图片、音频消息，按时间顺序排列。

## 4.3 聊天记录管理

- 记录搜索：按关键词搜索当前联系人的文字聊天记录，匹配结果高亮显示，同时提示匹配条数。

- 记录清空：清空与当前联系人的所有聊天记录（含文字、文件消息），操作不可恢复，数据库中对应记录永久删除。

## 4.4 管理员功能

- 管理员初始化：通过特殊链接创建唯一管理员账号，需验证安全密钥，防止恶意创建。

- 用户管理：查看所有用户列表，对普通用户执行禁言、封号/解封操作，封号用户无法登录系统。

- 聊天记录监控：查看任意用户的所有聊天记录，包含文字、文件消息及发送时间，便于系统管控。

## 4.5 安全与优化功能

- 文件上传验证：限制图片最大20MB、音频最大100MB，仅允许指定格式文件上传，防止恶意文件上传攻击。

- 唯一文件名：使用UUID生成唯一文件名，避免文件重名覆盖问题。

- 登录保护：登录失败3次后需输入验证码，失败5次后账号锁定1分钟，防止暴力破解。

- 会话验证：全局请求拦截器验证会话有效性，无效会话强制登出，保障账号安全。

# 五、详细使用方法

## 5.1 启动项目

1. 确保MySQL服务已正常启动（参考3.1步骤）。

2. 进入项目根目录，执行启动命令：
        `python app.py`

3. 启动成功后，命令行将显示以下信息，说明服务已正常运行：
        `MySQL数据库表初始化完成！
* Serving Flask app 'app'
* Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment.
* Running on http://127.0.0.1:5000
Press CTRL+C to quit
* Restarting with stat
* Debugger is active!
* Debugger PIN: 123-456-789`

4. 打开浏览器，访问 `http://127.0.0.1:5000` 进入项目页面。

## 5.2 管理员账号创建

1. 访问管理员初始化链接：`http://127.0.0.1:5000/init_admin`（仅当数据库无管理员账号时可访问）。

2. 填写创建表单：
        

    - 安全密钥：需与 `app.py` 中 `INIT_ADMIN_SECRET` 常量值一致

    - 管理员用户名：自定义（不可为「Administrator」，建议设为「admin」）。

    - 管理员密码：需符合「字母+数字组合，长度≥6位」（如「Admin123」）。

3. 提交后提示「管理员账号创建成功」，即可用该账号登录，自动跳转到管理员面板。

4. 注意：一旦创建管理员账号，再次访问 `/init_admin` 会提示无法重复创建，保障唯一性。

## 5.3 用户注册与登录

1. 注册流程：
        

    - 未登录状态下访问项目，自动跳转到登录页面，点击底部「立即注册」进入注册页。

    - 输入用户名（唯一）和密码（字母+数字组合，长度≥6位），点击「注册」。

    - 注册成功后自动跳转到登录页；若用户名已存在，页面提示错误并需更换用户名。

2. 登录流程：
        

    - 输入注册好的用户名和密码，点击「登录」。登录成功后进入聊天主页面；密码错误3次后需输入验证码，错误5次账号锁定1分钟。

    - 管理员登录后自动跳转到管理员面板，可执行用户管理操作。

3. 多用户测试说明：
        因Flask-Login的Session基于Cookie存储，同一浏览器的不同标签页/隐私窗口可能共享Cookie，导致用户身份覆盖。解决方案：使用不同浏览器（如Chrome和Edge），分别登录不同账号，避免会话冲突。

## 5.4 实时文字聊天

1. 登录后左侧为联系人列表，绿色圆点表示用户在线，灰色表示离线。

2. 点击联系人列表中的目标用户，右侧聊天窗口激活，底部输入框及功能按钮变为可用状态。

3. 在输入框中输入文字消息，点击「发送」按钮或按回车键，消息实时发送给对方，同时显示在聊天窗口中（自身消息居右，对方消息居左）。

4. 对方登录并选择当前用户后，可实时接收消息；若对方已打开聊天窗口，消息将自动刷新显示。

## 5.5 发送图片/音频文件

1. 选择联系人后，点击输入框左侧的「回形针」图标（文件上传按钮），弹出文件选择窗口。

2. 选择文件并上传：
        

    - 图片文件：支持png、jpg等格式，最大20MB。上传成功后聊天窗口显示图片预览，点击图片可查看原图。

    - 音频文件：支持mp3、wav等格式，最大100MB。上传成功后显示音频播放器，点击播放按钮可在线播放。

3. 若文件格式不支持或超过大小限制，页面会弹出对应错误提示，无法上传。

## 5.6 聊天记录管理

### 5.6.1 聊天记录搜索

1. 选择联系人后，聊天窗口顶部显示搜索框。

2. 输入关键词，点击「搜索」或按回车键，系统筛选当前联系人的文字聊天记录。

3. 搜索结果中关键词高亮显示（红色），顶部提示匹配条数；无匹配结果时提示「未找到包含'XXX'的消息」。

### 5.6.2 聊天记录清空

1. 选择联系人后，点击聊天窗口顶部的「清空记录」按钮。

2. 弹出确认框（提示「确定要清空与XXX的所有聊天记录吗？此操作不可恢复！」），点击「确定」完成清空。

3. 清空成功后，聊天窗口显示「聊天记录已清空」，数据库中对应记录永久删除。

## 5.7 管理员操作

1. 管理员面板访问：登录后自动跳转，或手动访问 `http://127.0.0.1:5000/admin/panel`。

2. 用户管理：
        

    - 禁言/解除禁言：点击用户对应的「禁言」按钮，切换用户禁言状态，禁言用户无法发送消息和文件。

    - 封号/解封：点击「封号」按钮，切换用户封号状态，封号用户无法登录系统，同时强制下线并清空会话ID。

3. 聊天记录查看：点击用户对应的「查看聊天记录」按钮，可查看该用户发送/接收的所有聊天记录，包含文字、图片、音频消息及发送时间。

## 5.8 用户退出

1. 点击左侧联系人列表顶部的「退出」链接。

2. 系统清空当前会话ID，更新用户在线状态为离线，页面跳转到登录页。其他用户的联系人列表中，该用户状态同步变为灰色圆点。

# 六、项目改进建议

本项目为简易版本，可从以下方向优化升级，提升功能完整性和用户体验：

- 会话存储优化：将Session存储从文件系统改为Redis，解决多浏览器/多设备会话冲突问题。

- 群聊功能：新增群聊表结构，支持创建群聊、多人实时聊天。

- 消息撤回/编辑：添加消息撤回、编辑功能，优化聊天交互体验。

- 用户资料管理：支持用户修改昵称、头像、密码等资料。

- 生产环境部署：使用Gunicorn作为WSGI服务器，Nginx作为反向代理，关闭Debug模式，提升系统稳定性和安全性。

- 消息通知：添加浏览器桌面通知，用户离线时收到新消息提醒。

欢迎大家基于本项目进行二次开发和改进，共同完善功能！


> （注：文档部分内容可能由 AI 生成）
