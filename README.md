# 简易flask聊天系统项目介绍文档

# 一、项目概述

本项目是一个基于Flask框架开发的简易聊天系统，支持用户注册登录、实时文字聊天、聊天记录搜索与清空、图片/音频文件发送等核心功能。系统采用前后端分离思想（前端嵌入模板），后端使用Flask提供API服务，通过SocketIO实现实时通信，MySQL存储用户与消息数据，适合用于学习Flask Web开发、实时通信技术及文件上传处理等场景。

# 二、技术栈说明

## 2.1 后端技术

- 核心框架：Flask（轻量级Python Web框架）

- 数据库ORM：Flask-SQLAlchemy（操作MySQL数据库）

- 用户认证：Flask-Login（管理用户会话与登录状态）

- 实时通信：Flask-SocketIO（基于WebSocket实现实时消息推送）

- 文件处理：Werkzeug（安全处理文件上传与文件名）

- 数据库：MySQL（存储用户信息、聊天记录、文件路径等数据）

## 2.2 前端技术

- 基础结构：HTML5（页面骨架）

- 样式美化：CSS3（页面布局与样式）

- 交互逻辑：JavaScript + jQuery（表单提交、DOM操作、AJAX请求）

- 图标支持：Font-Awesome（提供文件上传、状态等图标）

- 实时通信：SocketIO客户端（与后端建立WebSocket连接）

## 2.3 开发环境依赖

- Python版本：3.10

- MySQL版本：8.0

- 必要依赖包：flask、flask-sqlalchemy、flask-login、flask-socketio、pymysql、werkzeug、eventlet等

# 三、环境搭建步骤

## 3.1 本地环境准备

1. 安装Python：从Python官网下载对应系统版本（3.10），勾选"Add Python to PATH"，完成安装后在命令行执行 `python --version` 验证是否安装成功。

2. 安装MySQL：下载MySQL安装包（8.0），安装过程中设置root用户密码（本项目默认密码为123456，可后续修改），确保MySQL服务正常启动（可通过服务面板查看或执行 `net start mysql` 启动）。

## 3.2 项目部署与依赖安装
1. 依赖包安装：打开命令行，进入项目根目录，执行以下命令安装所需依赖：
        `pip install flask flask-sqlalchemy flask-login flask-socketio pymysql werkzeug eventlet`
        提示：若安装速度较慢，可使用国内镜像源，如添加 `-i https://pypi.tuna.tsinghua.edu.cn/simple`。
      

## 3.3 数据库配置

# 数据库创建
请执行以下SQL文件初始化数据库：[flask数据库.sql](https://raw.githubusercontent.com/FreedomSeeke/Flask-Chat/main/flask数据库.sql)


2. 修改数据库连接配置（可选）：若你的MySQL root密码不是123456，或数据库地址/端口有修改，需打开 `app.py`，修改以下配置项：
        `app.config['SQLALCHEMY_DATABASE_URI'] = 'mysql+pymysql://root:你的密码@localhost:3306/wechat_chat?charset=utf8mb4'`

# 四、核心功能说明

## 4.1 基础功能

- 用户注册：支持新用户创建账号（用户名唯一），密码采用PBKDF2-SHA256加密存储，保障安全。

- 用户登录/退出：登录时验证账号密码，记录用户在线状态；退出时更新在线状态并销毁会话。

- 联系人列表：展示所有已注册用户，通过绿色/灰色圆点区分在线/离线状态。

## 4.2 聊天功能

- 实时文字聊天：选择联系人后可发送文字消息，支持实时接收对方消息（基于SocketIO）。

- 文件发送：支持发送图片（png、jpg、jpeg、gif等）和音频（mp3、wav、ogg等）文件，图片可预览，音频可在线播放。

- 聊天记录加载：选择联系人后自动加载历史聊天记录，包含文字和文件消息。

## 4.3 聊天记录管理

- 聊天记录搜索：支持按关键词搜索当前联系人的文字聊天记录，关键词高亮显示。

- 聊天记录清空：支持清空与当前联系人的所有聊天记录（含文字和文件消息，不可恢复）。

## 4.4 其他优化功能

- 文件上传验证：限制图片最大20MB、音频最大100MB，仅支持指定格式文件，防止恶意上传。

- 唯一文件名：使用UUID生成唯一文件名，避免文件重名覆盖。

- 防缓存处理：添加HTTP防缓存头，避免页面缓存导致用户身份混淆。

# 五、详细使用方法

## 5.1 启动项目

1. 确保MySQL服务已启动（若未启动，执行 `net start mysql`，Windows系统；Linux/Mac执行 `sudo service mysql start`）。

2. 进入项目根目录，执行以下命令启动服务：
        `python app.py`
        启动成功后，命令行会显示以下信息：
        `MySQL数据库表初始化完成！
 * Serving Flask app 'app'
 * Debug mode: on
WARNING: This is a development server. Do not use it in a production deployment.
 * Running on http://127.0.0.1:5000
Press CTRL+C to quit
 * Restarting with stat
 * Debugger is active!
 * Debugger PIN: 123-456-789`

3. 打开浏览器，访问 `http://127.0.0.1:5000`，进入项目页面。

## 5.2 用户注册与登录

1. 首次访问时，页面会跳转到登录页面（因未登录），点击页面底部"立即注册"进入注册页面。

2. 注册页面：输入用户名（如user1）和密码（如123456），点击"注册"按钮。若用户名已存在，会提示"用户名已存在"，需更换用户名；注册成功后自动跳转到登录页面。

3. 登录页面：输入注册好的用户名和密码，点击"登录"按钮。登录成功后进入聊天主页面；若账号密码错误，会提示"用户名或密码错误"。

4. 多用户测试：为测试聊天功能，需注册至少两个账号。可通过以下方式实现：

打开两个`http://127.0.0.1:5000`网页

`此项目有个问题：Flask-Login 的 Session 基于 Cookie 存储，同一浏览器的不同标签页 / 隐私窗口会共享 Cookie（部分浏览器），或 SocketIO 连接未正确隔离用户会话。此外，用户的在线状态更新逻辑也存在漏洞，刷新页面时会导致用户身份覆盖（也就是两个网页的用户会变成一样的，只能退出重新登录另一个用户）。`

# 当然了，也有解决方法：
使用不同浏览器（如Chrome和edge），分别登录不同账号。

## 5.3 实时文字聊天

1. 登录后，左侧为联系人列表，显示所有已注册用户及在线状态（绿色圆点为在线，灰色为离线）。

2. 点击联系人列表中的某个用户（如user2），右侧聊天窗口会激活，输入框和功能按钮变为可用状态。

3. 在底部输入框中输入文字消息（如"你好！"），点击"发送"按钮或按回车键，消息会实时发送给对方，同时显示在聊天窗口中（自己的消息在右侧，对方的消息在左侧）。

4. 对方登录后选择当前用户，即可实时接收消息；若对方已打开聊天窗口，消息会自动刷新在窗口中。

## 5.4 发送图片/音频文件

1. 选择联系人后，点击输入框左侧的"回形针"图标（文件上传按钮）。

2. 在弹出的文件选择窗口中，选择图片或音频文件：
        图片文件：选择后自动上传，上传成功后聊天窗口会显示图片预览，点击图片可查看原图。

3. 音频文件：选择后自动上传，上传成功后聊天窗口会显示音频播放器，点击播放按钮可在线播放。

4. 若文件格式不支持或超过大小限制，会弹出提示（如"文件过大，图片最大支持20MB"）。

## 5.5 聊天记录搜索

1. 选择联系人后，聊天窗口顶部会显示搜索框。

2. 在搜索框中输入关键词（如"你好"），点击"搜索"按钮或按回车键。

3. 搜索结果会显示在聊天窗口中，包含关键词的消息会高亮显示（红色），顶部会提示"找到X条结果"；若未找到匹配结果，会提示"未找到包含'XXX'的消息"。

## 5.6 清空聊天记录

1. 选择联系人后，点击聊天窗口顶部的"清空记录"按钮。

2. 弹出确认框（"确定要清空与XXX的所有聊天记录吗？此操作不可恢复！"），点击"确定"。

3. 清空成功后，聊天窗口会显示"聊天记录已清空"，数据库中的对应聊天记录会被永久删除。

## 5.7 用户退出

1. 点击左侧联系人列表顶部的"退出"链接。

2. 退出成功后，页面跳转到登录页面，用户在线状态更新为离线，其他用户的联系人列表中该用户会显示灰色圆点。

   
# 另外欢迎大家进行改进
<img width="200" height="200" alt="IMG_20251130_164645" src="https://github.com/user-attachments/assets/6c130c02-1bc9-470e-b95a-740d33538daa" />
